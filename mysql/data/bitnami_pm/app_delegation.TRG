TYPE=TRIGGERS
triggers='CREATE DEFINER=`bn_processmaker`@`127.0.0.1` TRIGGER APP_DELEGATION_INSERT BEFORE INSERT ON APP_DELEGATION\nFOR EACH ROW\nBEGIN\n  DECLARE DEFAULT_LANG VARCHAR(2);\n  DECLARE APP_NUMBER INT;\n  DECLARE APP_STATUS VARCHAR(32);\n  DECLARE APP_CREATE_DATE DATETIME;\n  DECLARE APP_UPDATE_DATE DATETIME;\n  DECLARE APP_TITLE VARCHAR(255);\n  DECLARE APP_PRO_TITLE VARCHAR(255);\n  DECLARE APP_TAS_TITLE VARCHAR(255);\n  DECLARE APP_CURRENT_USER VARCHAR(255);\n  DECLARE PREVIOUS_USR_UID VARCHAR(32);\n  DECLARE APP_DEL_PREVIOUS_USER VARCHAR(255);\n  DECLARE APP_THREAD_STATUS VARCHAR(32);\n  SET @DEFAULT_LANG = \'en\';\n  SET @APP_CURRENT_USER = \'\';\n  SELECT APPLICATION.APP_NUMBER into @APP_NUMBER FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_STATUS into @APP_STATUS FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_CREATE_DATE into @APP_CREATE_DATE FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_UPDATE_DATE into @APP_UPDATE_DATE FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n\n  SELECT APPLICATION.APP_TITLE into @APP_TITLE FROM APPLICATION WHERE NEW.APP_UID=APPLICATION.APP_UID LIMIT 1;\n  IF ( @APP_TITLE IS NULL ) THEN\n    SET @APP_TITLE = \'\';\n  END IF;\n  SELECT PROCESS.PRO_TITLE into @APP_PRO_TITLE FROM PROCESS WHERE NEW.PRO_UID=PROCESS.PRO_UID LIMIT 1;\n  SELECT TASK.TAS_TITLE into @APP_TAS_TITLE FROM TASK WHERE NEW.TAS_UID=TASK.TAS_UID LIMIT 1;\n  SELECT CONCAT(USERS.USR_LASTNAME,  \' \',  USERS.USR_FIRSTNAME) INTO @APP_CURRENT_USER FROM USERS WHERE USR_UID = NEW.USR_UID LIMIT 1;\n  IF ( @APP_CURRENT_USER IS NULL ) THEN\n    SET @APP_CURRENT_USER = \'\';\n  END IF;\n  IF ( NEW.DEL_PREVIOUS > 0 ) THEN\n    SELECT USR_UID INTO @PREVIOUS_USR_UID FROM APP_DELEGATION WHERE APP_UID = NEW.APP_UID AND DEL_INDEX = NEW.DEL_PREVIOUS LIMIT 1;\n    SELECT CONCAT(USERS.USR_LASTNAME,  \' \',  USERS.USR_FIRSTNAME) INTO @APP_DEL_PREVIOUS_USER FROM USERS WHERE USR_UID = @PREVIOUS_USR_UID LIMIT 1;\n    IF ( @APP_DEL_PREVIOUS_USER IS NULL ) THEN\n      SET @APP_DEL_PREVIOUS_USER = \'\';\n    END IF;\n  ELSE\n    SET @APP_DEL_PREVIOUS_USER = \'\';\n    SET @PREVIOUS_USR_UID = \'\';\n  END IF;\n  SELECT APP_THREAD_STATUS INTO @APP_THREAD_STATUS FROM APP_THREAD WHERE APP_UID = NEW.APP_UID AND DEL_INDEX = NEW.DEL_PREVIOUS LIMIT 1;\n  IF ( @APP_THREAD_STATUS IS NULL ) THEN\n    SET @APP_THREAD_STATUS = \'OPEN\';\n  END IF;\n  SET @TAS_TYPE = (SELECT TAS_TYPE FROM TASK WHERE TAS_UID = NEW.TAS_UID LIMIT 1);\n  UPDATE APP_CACHE_VIEW SET DEL_LAST_INDEX = 0 WHERE APP_UID = NEW.APP_UID;\n    INSERT INTO `APP_CACHE_VIEW`  (\n    APP_UID,\n    DEL_INDEX,\n    APP_NUMBER,\n    APP_STATUS,\n    USR_UID,\n    PREVIOUS_USR_UID,\n    TAS_UID,\n    PRO_UID,\n    DEL_DELEGATE_DATE,\n    DEL_INIT_DATE,\n    DEL_FINISH_DATE,\n    DEL_TASK_DUE_DATE,\n    DEL_RISK_DATE,\n    DEL_THREAD_STATUS,\n    APP_THREAD_STATUS,\n    APP_TITLE,\n    APP_PRO_TITLE,\n    APP_TAS_TITLE,\n    APP_CURRENT_USER,\n    APP_DEL_PREVIOUS_USER,\n    DEL_PRIORITY,\n    DEL_DURATION,\n    DEL_QUEUE_DURATION,\n    DEL_DELAY_DURATION,\n    DEL_STARTED,\n    DEL_FINISHED,\n    DEL_DELAYED,\n    APP_CREATE_DATE,\n    APP_FINISH_DATE,\n    APP_UPDATE_DATE,\n    APP_OVERDUE_PERCENTAGE,\n    DEL_LAST_INDEX\n  )\n  VALUES (\n    NEW.APP_UID,\n    NEW.DEL_INDEX,\n    @APP_NUMBER,\n    @APP_STATUS,\n    NEW.USR_UID,\n    @PREVIOUS_USR_UID,\n    NEW.TAS_UID,\n    NEW.PRO_UID,\n    NEW.DEL_DELEGATE_DATE,\n    NEW.DEL_INIT_DATE,\n    NEW.DEL_FINISH_DATE,\n    NEW.DEL_TASK_DUE_DATE,\n    NEW.DEL_RISK_DATE,\n    NEW.DEL_THREAD_STATUS,\n    @APP_THREAD_STATUS,\n    @APP_TITLE,\n    @APP_PRO_TITLE,\n    @APP_TAS_TITLE,\n    @APP_CURRENT_USER,\n    @APP_DEL_PREVIOUS_USER,\n    NEW.DEL_PRIORITY,\n    NEW.DEL_DURATION,\n    NEW.DEL_QUEUE_DURATION,\n    NEW.DEL_DELAY_DURATION,\n    NEW.DEL_STARTED,\n    NEW.DEL_FINISHED,\n    NEW.DEL_DELAYED,\n    @APP_CREATE_DATE,\n    NULL,\n    @APP_UPDATE_DATE,\n    NEW.APP_OVERDUE_PERCENTAGE,\n    NEW.DEL_LAST_INDEX\n  );\nEND' 'CREATE DEFINER=`bn_processmaker`@`127.0.0.1` TRIGGER APP_DELEGATION_UPDATE BEFORE UPDATE ON APP_DELEGATION\nFOR EACH ROW\nBEGIN\n  DECLARE DEFAULT_LANG VARCHAR(2);\n  DECLARE APP_NUMBER INT;\n  DECLARE APP_STATUS VARCHAR(32);\n  DECLARE APP_CREATE_DATE DATETIME;\n  DECLARE APP_UPDATE_DATE DATETIME;\n  DECLARE APP_TITLE VARCHAR(255);\n  DECLARE APP_PRO_TITLE VARCHAR(255);\n  DECLARE APP_TAS_TITLE VARCHAR(255);\n  DECLARE APP_CURRENT_USER VARCHAR(255);\n  DECLARE PREVIOUS_USR_UID VARCHAR(32);\n  DECLARE APP_DEL_PREVIOUS_USER VARCHAR(255);\n  DECLARE APP_THREAD_STATUS VARCHAR(32);\n  SET @DEFAULT_LANG = \'en\';\n  SET @APP_CURRENT_USER = \'\';\n  SELECT APPLICATION.APP_NUMBER into @APP_NUMBER FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_STATUS into @APP_STATUS FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_CREATE_DATE into @APP_CREATE_DATE FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n  SELECT APPLICATION.APP_UPDATE_DATE into @APP_UPDATE_DATE FROM APPLICATION WHERE APP_UID = NEW.APP_UID LIMIT 1;\n\n  SELECT APPLICATION.APP_TITLE into @APP_TITLE FROM APPLICATION WHERE NEW.APP_UID=APPLICATION.APP_UID LIMIT 1;\n  IF ( @APP_TITLE IS NULL ) THEN\n    SET @APP_TITLE = \'\';\n  END IF;\n  SELECT PROCESS.PRO_TITLE into @APP_PRO_TITLE FROM PROCESS WHERE NEW.PRO_UID=PROCESS.PRO_UID LIMIT 1;\n  SELECT TASK.TAS_TITLE into @APP_TAS_TITLE FROM TASK WHERE NEW.TAS_UID=TASK.TAS_UID LIMIT 1;\n  SELECT CONCAT(USERS.USR_LASTNAME,  \' \',  USERS.USR_FIRSTNAME) INTO @APP_CURRENT_USER FROM USERS WHERE USR_UID = NEW.USR_UID LIMIT 1;\n  IF ( @APP_CURRENT_USER IS NULL ) THEN\n    SET @APP_CURRENT_USER = \'\';\n  END IF;\n  IF ( NEW.DEL_PREVIOUS > 0 ) THEN\n    SELECT USR_UID INTO @PREVIOUS_USR_UID FROM APP_DELEGATION WHERE APP_UID = NEW.APP_UID AND DEL_INDEX = NEW.DEL_PREVIOUS LIMIT 1;\n    SELECT CONCAT(USERS.USR_LASTNAME,  \' \',  USERS.USR_FIRSTNAME) INTO @APP_DEL_PREVIOUS_USER FROM USERS WHERE USR_UID = @PREVIOUS_USR_UID LIMIT 1;\n    IF ( @APP_DEL_PREVIOUS_USER IS NULL ) THEN\n      SET @APP_DEL_PREVIOUS_USER = \'\';\n    END IF;\n  ELSE\n    SET @APP_DEL_PREVIOUS_USER = \'\';\n    SET @PREVIOUS_USR_UID = \'\';\n  END IF;\n  SELECT APP_THREAD_STATUS INTO @APP_THREAD_STATUS FROM APP_THREAD WHERE APP_UID = NEW.APP_UID AND DEL_INDEX = NEW.DEL_PREVIOUS LIMIT 1;\n  IF ( @APP_THREAD_STATUS IS NULL ) THEN\n    SET @APP_THREAD_STATUS = \'OPEN\';\n  END IF;\n  SET @TAS_TYPE = (SELECT TAS_TYPE FROM TASK WHERE TAS_UID = NEW.TAS_UID LIMIT 1);\n    UPDATE `APP_CACHE_VIEW`\n    SET\n    APP_NUMBER            =   @APP_NUMBER,\n    APP_STATUS            =   @APP_STATUS,\n    USR_UID               =   NEW.USR_UID,\n    PREVIOUS_USR_UID      =   @PREVIOUS_USR_UID,\n    TAS_UID               =   NEW.TAS_UID,\n    PRO_UID               =   NEW.PRO_UID,\n    DEL_DELEGATE_DATE     =   NEW.DEL_DELEGATE_DATE,\n    DEL_INIT_DATE         =   NEW.DEL_INIT_DATE,\n    DEL_FINISH_DATE       =   NEW.DEL_FINISH_DATE,\n    DEL_TASK_DUE_DATE     =   NEW.DEL_TASK_DUE_DATE,\n    DEL_RISK_DATE         =   NEW.DEL_RISK_DATE,\n    DEL_THREAD_STATUS     =   NEW.DEL_THREAD_STATUS,\n    APP_THREAD_STATUS     =   @APP_THREAD_STATUS,\n    APP_TITLE             =   @APP_TITLE,\n    APP_PRO_TITLE         =   @APP_PRO_TITLE,\n    APP_TAS_TITLE         =   @APP_TAS_TITLE,\n    APP_CURRENT_USER      =   @APP_CURRENT_USER,\n    APP_DEL_PREVIOUS_USER =   @APP_DEL_PREVIOUS_USER,\n    DEL_PRIORITY          =   NEW.DEL_PRIORITY,\n    DEL_DURATION          =   NEW.DEL_DURATION,\n    DEL_QUEUE_DURATION    =   NEW.DEL_QUEUE_DURATION,\n    DEL_DELAY_DURATION    =   NEW.DEL_DELAY_DURATION,\n    DEL_STARTED           =   NEW.DEL_STARTED,\n    DEL_FINISHED          =   NEW.DEL_FINISHED,\n    DEL_DELAYED           =   NEW.DEL_DELAYED,\n    APP_FINISH_DATE       =   NULL,\n    APP_UPDATE_DATE        =  @APP_UPDATE_DATE,\n    APP_OVERDUE_PERCENTAGE =  NEW.APP_OVERDUE_PERCENTAGE,\n    DEL_LAST_INDEX        =   NEW.DEL_LAST_INDEX\n  WHERE\n    APP_UID = NEW.APP_UID\n    AND DEL_INDEX =   NEW.DEL_INDEX;\nEND'
sql_modes=0 0
definers='bn_processmaker@127.0.0.1' 'bn_processmaker@127.0.0.1'
client_cs_names='utf8' 'utf8'
connection_cl_names='utf8_general_ci' 'utf8_general_ci'
db_cl_names='utf8_general_ci' 'utf8_general_ci'
